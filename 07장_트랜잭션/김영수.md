# 7ì¥ íŠ¸ëœì­ì…˜

í˜„ì‹¤ ì„¸ê³„ì—ì„œì˜ ë°ì´í„° ì‹œìŠ¤í…œì€ ì–´ë–¤ ë¬¸ì œë“  ìƒê¸¸ ìˆ˜ ìˆë‹¤.

- ï»¿ï»¿ë°ì´í„°ë² ì´ìŠ¤ ì†Œí”„íŠ¸ì›¨ì–´ë‚˜ í•˜ë“œì›¨ì–´ëŠ” (ì“°ê¸° ì—°ì‚°ì´ ì‹¤í–‰ ì¤‘ì¼ ë•Œë¥¼ í¬í•¨í•´ì„œ) ì–¸ì œë¼ë„ ì‹¤íŒ¨í•  ìˆ˜ ìˆë‹¤.
- ï»¿ï»¿ì• í”Œë¦¬ì¼€ì´ì…˜ì€ (ì—°ì†ëœ ì—°ì‚°ì´ ì‹¤í–‰ë˜ëŠ” ë„ì¤‘ë„ í¬í•¨í•´ì„œ) ì–¸ì œë¼ë„ ì£½ì„ ìˆ˜ ìˆë‹¤.
- ï»¿ï»¿ë„¤íŠ¸ì›Œí¬ê°€ ëŠê¸°ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì—°ê²°ì´ ê°‘ìê¸° ëŠê¸°ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ ë…¸ë“œ ì‚¬ì´ì˜ í†µì‹ ì´ ì•ˆ ë  ìˆ˜ ìˆë‹¤.
- ï»¿ï»¿ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ ë™ì‹œì— ë°ì´í„°ë² ì´ìŠ¤ì— ì“°ê¸°ë¥¼ ì‹¤í–‰í•´ì„œ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ê°€ ì“´ ë‚´ìš©ì„ ë®ì–´ì“¸ ìˆ˜ ìˆë‹¤.
- ï»¿ï»¿í´ë¼ì´ì–¸íŠ¸ê°€ ë¶€ë¶„ì ìœ¼ë¡œë§Œ ê°±ì‹ ë¼ì„œ ë¹„ì •ìƒì ì¸ ë°ì´í„°ë¥¼ ì½ì„ ìˆ˜ ìˆë‹¤.
- ï»¿ï»¿í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ì˜ ê²½ìŸ ì¡°ê±´ì€ ì˜ˆì¸¡í•˜ì§€ ëª»í•œ ë²„ê·¸ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.

íŠ¸ëœì­ì…˜ì€ ì‹œìŠ¤í…œ ì‹ ë¢°ì„±ì„ ë†’ì´ê¸° ìœ„í•´, ì „ì²´ ì‹œìŠ¤í…œì˜ ì¥ì• ë¡œ ì´ì–´ì§€ëŠ”ê²ƒì„ ë‹¨ìˆœí™” í•˜ê¸° ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤.

ëª‡ê°œì˜ ì½ê¸°ì™€ ì“°ê¸°ë¥¼ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ í•œ ì—°ì‚°ìœ¼ë¡œ ë¬¶ëŠ”ê²ƒì´ë‹¤.

íŠ¸ëœì­ì…˜ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì–´ëŠì •ë„ì˜ ì ì¬ì ì¸ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë™ì‹œì„± ë¬¸ì œë¥¼ ë¬´ì‹œí•  ìˆ˜ ìˆë‹¤. 

ë‹¤ì–‘í•œ ê²½ìŸ ì¡°ê±´ê³¼ read committed, snapshot isolation, serializabilityê°™ì€ ê²©ë¦¬ ìˆ˜ì¤€ì˜ ì›ë¦¬ë¥¼ ì•Œì•„ë³´ì

## ì• ë§¤ëª¨í˜¸í•œ íŠ¸ëœì­ì…˜ì˜ ê°œë…

2000ë…„ëŒ€ í›„ë°˜ NoSQL DBë¥¼ ì£¼ë˜ê²Œ ì‚¬ìš©í•¨ìœ¼ë¡œì¨, ì´ DBë“¤ì˜ ë‹¤ìˆ˜ëŠ” íŠ¸ëœì­ì…˜ì„ í¬ê¸°í•˜ê±°ë‚˜ ê³¼ê±°ë³´ë‹¤ ì•½í•œ ë³´ì¥ì„ ì˜ë¯¸í•˜ëŠ” ë‹¨ì–´ë¡œ íŠ¸ëœì­ì…˜ì˜ ì˜ë¯¸ë¥¼ ì¬ì •ì˜ í–ˆë‹¤. ê·¸ëŸ¬ë‚˜ íŠ¸ëœì­ì…˜ì´ ì œê³µí•˜ëŠ” ì„¸ë¶€ ì‚¬í•­ì„ ìƒì„¸íˆ í™•ì¸í•´ë³´ê³  ì í•©í•˜ê²Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤

### ACIDì˜ ì˜ë¯¸

**ACID íŠ¹ì„±**

- **Atomicity(ì›ìì„±)**: íŠ¸ëœì­ì…˜ì˜ ëª¨ë“  ì—°ì‚°ì´ ì „ë¶€ ì„±ê³µí•˜ê±°ë‚˜ ì „ë¶€ ì‹¤íŒ¨(Abort/ë¡¤ë°±)
- **Consistency(ì¼ê´€ì„±)**: íŠ¸ëœì­ì…˜ ì „í›„ì˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì •ì˜ëœ ì œì•½ì¡°ê±´ì„ í•­ìƒ ë§Œì¡±
- **Isolation(ê²©ë¦¬ì„±)**: ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëœì­ì…˜ ê°„ì˜ ìƒí˜¸ ê°„ì„­ ë°©ì§€
- **Durability(ë‚´êµ¬ì„±)**: ì»¤ë°‹ëœ ê²°ê³¼ëŠ” ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë‚˜ë„ ë³´ì¡´

* ACID í‘œì¤€ì„ ë”°ë¥´ì§€ ì•ŠëŠ” ì‹œìŠ¤í…œì€ BASEë¼ê³  í•˜ë©°, ê¸°ë³¸ ê°€ìš©ì„±(Basicially Available), ìœ ì—°í•œ ìƒíƒœ(Soft state), ìµœì¢… ì¼ê´€ì„±(Eventual consistency)ë¥¼ ì§€ë‹Œë‹¤ëŠ” ê²ƒ.

#### ì›ìì„± (Atomicity)

ì›ì : ë” ì‘ì€ë¶€ë¶„ìœ¼ë¡œ ìª¼ê°¤ ìˆ˜ ì—†ëŠ” ë¬´ì–¸ê°€. ì›ìì„±ì€ ë™ì‹œì„±ê³¼ ê´€ë ¨ì´ ì—†ìŒ

ACIDì—ì„œ ë§í•˜ëŠ” ì›ìì„±ì€, ì—¬ëŸ¬ ì“°ê¸° ì‘ì—… ìˆ˜í–‰ì‹œ ì¼ë¶€ë§Œ ì²˜ë¦¬ë˜ëŠ” ì¼€ì´ìŠ¤ëŠ” ì—†ë„ë¡ í•œê²ƒ.

ì›ìì„± ì—†ì´ëŠ” ì—¬ëŸ¬ ë³€ê²½ ì ìš© ë„ì¤‘ ì˜¤ë¥˜ ë°œìƒì‹œ, ì–´ë–¤ ë³€ê²½ì€ íš¨ê³¼ê°€ ìˆê¼¬ ì–´ë–¤ ê²ƒì€ ê·¸ë ‡ì§€ ì•Šì€ì§€ ì•Œê¸° ì–´ë ¤ì›€.

ì˜¤ë¥˜ ìƒê²¼ì„ ì‹œ íŠ¸ëœì­ì…˜ì„ abortí•˜ê³  ì·¨ì†Œí•˜ëŠ” ê²ƒì€ ì›ìì„±ì˜ íŠ¹ì§•ì´ë‹¤.

#### ì¼ê´€ì„±(consistency)

ì¼ê´€ì„±ì€ ì—¬ëŸ¬ ì˜ë¯¸ë¡œ ì“°ì„

ì›ìì„± ê²©ë¦¬ì„± ì§€ì†ì„±ì€ DBì†ì„±ì¸ ë°˜ë©´, ì¼ê´€ì„±ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì†ì„±ì´ë‹¤. ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ì´ë‚˜ ìœ ë‹ˆí¬ ì œì•½ì¡°ê±´ì„ ì“¸ ìˆœ ìˆì§€ë§Œ ì¼ë°˜ì ìœ¼ë¡œ DBëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ê°€ ìœ íš¨í•œì§€ ì•„ë‹Œì§€ íŒë‹¨í•˜ê³  ê·¸ê±¸ ì €ì¥í•  ë¿ì´ë‹¤. 

#### ê²©ë¦¬ì„± (isolation)

ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë™ì‹œ DB ì ‘ì†ì‹œ ë™ì¼ ë ˆì½”ë“œì— ì ‘ê·¼í•˜ë©´ ë™ì‹œì„± ë¬¸ì œê°€ ìƒê¸´ë‹¤.

ACIDì—ì„œ ê²©ë¦¬ì„±ì€ ë™ì‹œ ì‹¤í–‰ íŠ¸ëœì­ì…˜ì€ ì„œë¡œ ê²©ë¦¬ëœë‹¤ëŠ”ê²ƒì„ ì˜ë¯¸í•˜ë©°, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì„ ë°©í•´í•  ìˆ˜ ì—†ëŠ”ê²ƒìœ¼ë¡œ ì •ì˜í•œë‹¤.

#### ì§€ì†ì„±(durability, ë‚´êµ¬ì„±)

ì§€ì†ì„±ì€ íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ëœë‹¤ë©´, í•˜ë“œì›¨ì–´ ê²°í•¨ì´ë‚˜ DBê°€ ì£½ë”ë¼ë„ ê¸°ë¡í•œ ëª¨ë“  ë°ì´í„°ëŠ” ì†ì‹¤ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë³´ì¥ì´ë‹¤.

### ë‹¨ì¼ ê°ì²´ ì—°ì‚°ê³¼ ë‹¤ì¤‘ ê°ì²´ ì—°ì‚°

ACIDì—ì„œ ì›ìì„±ê³¼ ê²©ë¦¬ì„±ì€ í´ë¼ì´ì–¸íŠ¸ê°€ í•œ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì—¬ëŸ¬ ì“°ê¸°ë¥¼ í•˜ë©´ DBê°€ ì–´ë–»ê²Œ í•´ì•¼í•˜ëŠ”ì§€ë¥¼ ì •ì˜í•¨

* ì›ìì„± : ì“°ê¸° ì´ì–´ ì‹¤í–‰ ë„ì¤‘ ì˜¤ë¥˜ ë°œìƒì‹œ íŠ¸ëœì­ì…˜ì€ ì–´ë³´íŠ¸ ë¼ì•¼ í•˜ê³ , ì“°ì—¬ì§„ ë‚´ìš©ì€ íê¸°ë˜ì–´ì„œ ì „ë¶€ ë°˜ì˜ë˜ê±°ë‚˜ ì „ë¶€ ì‹¤íŒ¨í•´ì•¼í•¨.
* ê²©ë¦¬ì„± : ë™ì‹œ ì‹¤í–‰ë˜ëŠ” íŠ¸ëœì­ì…˜ë“¤ì€ ì„œë¡œë¥¼ ë°œí•´í•˜ì§€ ë§ì•„ì•¼ í•¨. í•œ íŠ¸ëœì­ì…˜ì´ ì—¬ëŸ¬ë²ˆì“´ë‹¤ë©´, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì€ ê·¸ ë‚´ìš©ì„ ì „ë³´ ë³¼ìˆ˜ìˆë˜ì§€ ì•„ë¬´ê²ƒë„ ë³¼ìˆ˜ì—†ë“ ì§€ í•´ì•¼ í•¨.

### ë‹¨ì¼ ê°ì²´ ì“°ê¸°

ì›ìì„±ê³¼ ê²©ë¦¬ì„±ì€ ë‹¨ì¼ ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ê²½ìš°ì—ë„ ì ìš©ëœë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 20KBì˜ JSON ë¬¸ì„œë¥¼ ë° ì´í„°ë² ì´ìŠ¤ì— ì“´ë‹¤ê³  í•´ë³´ì.

- ï»¿ï»¿ì²« 10KBë¥¼ ë³´ë‚¸ í›„ì— ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠê¸°ë©´ ë°ì´í„°ë² ì´ìŠ¤ëŠ” íŒŒì‹± ë¶ˆê°€ëŠ¥í•œ 10KBì˜ JSON ì¡°ê°ì„ ì €ì¥í•  ê²ƒì¸ê°€?
- ï»¿ï»¿ë°ì´í„°ë² ì´ìŠ¤ê°€ ë””ìŠ¤í¬ì— ì €ì¥ëœ ê¸°ì¡´ ê°’ì„ ë®ì–´ì“°ëŠ” ë„ì¤‘ì— ì „ì›ì´ ë‚˜ê°€ë©´ ê¸°ì¡´ ê°’ê³¼ ìƒˆ ê°’ì´ í•¨ê»˜ ë¶™ì–´ ìˆê²Œ ë ê¹Œ?
- ï»¿ï»¿ë¬¸ì„œë¥¼ ì“°ê³  ìˆì„ ë•Œ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê·¸ ë¬¸ì„œë¥¼ ì½ìœ¼ë©´ ë¶€ë¶„ì ìœ¼ë¡œ ê°±ì‹ ëœ ê°’ì„ ì½ê²Œ ë ê¹Œ?

ìœ„ ë¬¸ì œë¥¼ ë°©ì§€í•  ìˆ˜ë„ ìˆì§€ë§Œ íŠ¸ëœì­ì…˜ì€ ë³´í†µ ë‹¤ì¤‘ ì—°ì‚°ì„ í•˜ë‚˜ì˜ ì‹¤í–‰ë‹¨ìœ„ë¡œ ë¬¶ëŠ” ë©”ì»¤ë‹ˆì¦˜

### ë‹¤ì¤‘ ê°ì²´ íŠ¸ëœì­ì…˜ì˜ í•„ìš”ì„±

ë§ì€ ë¶„ì‚° ë°ì´í„°ìŠ¤í† ì–´ëŠ” ë‹¤ì¤‘ ê°ì²´ íŠ¸ëœì­ì…˜ ì§€ì›ì„ í¬ê¸°í•¨. ì—¬ëŸ¬ ë…¸ë“œì— ê±¸ì³ êµ¬í˜„í•˜ê¸°ê°€ ì–´ë µê³  ê°€ìš©ì„±ê³¼ ì„±ëŠ¥ì´ ì˜ ì•ˆë‚˜ì˜¤ê¸° ë•Œë¬¸

ë§ì€ ê²½ìš°ì—ëŠ” ì—¬ëŸ¬ ì“°ê¸° ì‘ì—…ì´ ì¤‘ì¬ ë˜ì–´ì•¼ í•¨

* ëª½ê³ ë””ë¹„ê°™ì€ê²½ìš°, ë°ì´í„°ê°€ ë¹„ì •ê·œí™”ë˜ì–´ìˆì–´ ì¤‘ë³µë˜ì–´ìˆëŠ”ë° ê°±ì‹ í• ë•Œ í•œë²ˆì— ì—¬ëŸ¬ ë¬¸ì„œë¥¼ ê°±ì‹ í•´ì•¼ í•´ì„œ íŠ¸ëœì­ì…˜ì´ í•„ìš”í•¨
* ë³´ì¡° ìƒ‰ì¸ì´ ìˆëŠ” DBì—ì„œëŠ” ê°’ ë³€ê²½ì‹œ ë³´ì¡° ìƒ‰ì¸ë„ ë³€ê²½ë˜ì–´ì•¼í•˜ëŠ”ë° íŠ¸ëœì­ì…˜ ê´€ì ì—ì„œ ìƒ‰ì¸ê³¼ ë³´ì¡° ìƒ‰ì¸ì€ ë‹¤ë¥¸ ê°ì²´ì„. ì´ ë‘˜ì´ ì¼ì¹˜í•˜ì§€ ì•Šì„ìˆ˜ë„ ìˆìŒ

### ì˜¤ë¥˜ì™€ ì–´ë³´íŠ¸ ì²˜ë¦¬

ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ì–´ë³´íŠ¸ëœ íŠ¸ëœì­ì…˜ì„ ì¬ì‹œë„í•˜ì§€ ì•ŠìŒ. ì™œ?

* ì‹¤ì œë¡œëŠ” ì„±ê³µí–ˆì§€ë§Œ ì»¤ë°‹ ì„±ê³µì„ ì•Œë¦¬ëŠ” ë„¤íŠ¸ì›Œí¬ê°€ ëŠê²»ì„ ì‹œ ì¬ì‹œë„ì‹œí•˜ë©´ íŠ¸ëœì­ì…˜ì´ ë‘ë²ˆ ì‹¤í–‰ëŒ. ì¤‘ë³µ ì²˜ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì´ ì—†ìœ¼ë©´ í°ì¼
* ì˜¤ë¥˜ê°€ ê³¼ë¶€í•˜ë•Œë¬¸ì´ë¼ë©´ ì¬ì‹œë„ì‹œ ì¥ì• ë¥¼ ì¶”ê°€ë¡œ ìœ ë°œ ê°€ëŠ¥.
* ì¼ì‹œì ì¸ ì˜¤ë¥˜ë§Œ ì¬ì‹œë„í•  ê°€ì¹˜ê°€ ìˆìŒ. ì œì•½ì¡°ê±´ ìœ„ë°˜ ë“±ì€ ì¬ì‹œë„í•  í•„ìš”ê°€ ì—†ìŒ 
* í´ë¼ì´ì–¸íŠ¸ê°€ ì¬ì‹œë„ì¤‘ì— ì£½ì–´ë²„ë¦¬ë©´ dbì— ì“°ë ¤ê³  í–ˆë˜ ë°ì´í„°ê°€ ëª¨ë‘ ì†ì‹¤ëŒ

## ì™„í™”ëœ ê²©ë¦¬ ìˆ˜ì¤€

ê°™ì€ ë°ì´í„°ë¥¼ ë™ì‹œì— ì“°ë ¤ëŠ” ë™ì‹œì„± ë¬¸ì œë¥¼ íŠ¸ëœì­ì…˜ì€ ê²©ë¦¬ë¡œ í•´ê²°í•˜ë ¤ê³  í•œë‹¤.

ê·¸ëŸ¬ë‚˜ ì§ë ¬ë¡œ(serialize)ì²˜ë¦¬í•˜ë ¤ê³  í•˜ë©´ ê°„ë‹¨í•˜ì§€ì•Šë‹¤. 

* ì„±ëŠ¥ ë¹„ìš©ì´ ìˆìŒ ë§¤ìš° ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ.

ë•Œë¬¸ì— ì™„í™”ëœ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œë“¤ì´ í”í•¨. ì™œ? ì–´ì°¨í”¼ 100% ë³´ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì„

ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì¢€ë” ì™„í™”ëœ ë°©ë²•ì„ ì•Œì•„ë³´ì

### ì»¤ë°‹í›„ ì½ê¸°

ê°€ì¥ ê¸°ë³¸ì ì¸ ìˆ˜ì¤€. read committed. ì´ê²ƒì€ 2ê°€ì§€ë¥¼ ë³´ì¥í•´ì¤Œ

1. ì½ì„ë•Œ ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ë³´ê²Œ ëŒ - ë”í‹° ì½ê¸°ê°€ ì—†ìŒ
2. ì“¸ë•Œ ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ë®ì–´ì”€ - ë”í‹° ì“°ê¸°ê°€ ì—†ìŒ

#### ë”í‹° ì½ê¸° ë°©ì§€

ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ë³´ëŠ”ê²ƒì´ ë”í‹° ì½ê¸°ì´ë‹¤. 

ì™œ í•„ìš”í• ê¹Œ?

* ë”í‹° ì½ê¸°ê°€ ìƒê¸°ë©´, ì–´ë–¤ íŠ¸ëœì­ì…˜ì€ ê°±ì‹ ëœ ê°’ì„, ì–´ë–¤ íŠ¸ëœì­ì…˜ì€ ê°±ì‹ ë˜ì§€ ì•Šì€ ê°’ì„ ì½ì–´ ë²„ê·¸ ìœ ë°œ ê°€ëŠ¥
* íŠ¸ëœì­ì…˜ ì–´ë³´íŠ¸ì‹œ ëª¨ë‘ ë¡¤ë°±ë˜ì–´ì•¼ í•˜ëŠ”ë°, ë””ë¹„ê°€ ë”í‹° ì½ê¸°ë¥¼ í—ˆìš©í•˜ë©´ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë  ë°ì´í„° ì¦‰ ì•„ì§ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆê²Œ ëŒ

#### ë”í‹° ì“°ê¸° ë°©ì§€

ë‚˜ì¤‘ì— ì“´ ë‚´ìš©ì´ ë¨¼ì € ì“´ ë‚´ìš©ì„ ë®ì–´ ì“°ëŠ” ë¬¸ì œ.

ë¨¼ì € ì“´ ë‚´ìš©ì´ ì•„ì§ ì»¤ë°‹ë˜ì§€ ì•Šì€ íŠ¸ëœì­ì…˜ì—ì„œ ì“´ê²ƒì´ê³  ë‚˜ì¤‘ì— ì“´ê²ƒì´ì»¤ë°‹ë˜ì§€ ì•Šì€ ê°’ì„ ë®ì–´ì¨ë²„ë¦¬ëŠ” ë¬¸ì œ.

ì´ê±¸ ë§‰ìœ¼ë¯€ë¡œì¨ ì•„ë˜ë¥¼ íšŒí”¼í•œë‹¤.

* ë°¥ê³¼ ì•¨ë¦¬ìŠ¤ê°€ ê°™ì€ ì°¨ë¥¼ ì‚¬ë ¤ê³  í•  ë•Œ, ë°¥ì—ê²Œ íŒë§¤ëì§€ë§Œ, ì´í›„ ì•¨ë¦¬ìŠ¤ê°€ ë°”ë¡œ ë®ì–´ì¨ì„œ ì•¨ë¦¬ìŠ¤ì—ê²Œ ì†¡ì¥ì´ ì „ë‹¬ë  ìˆ˜ ìˆìŒ
* ê·¸ë¦¬ê³  ìˆ«ì ì¹´ìš´íŠ¸ë¥¼ ë‘ë²ˆ ì¦ê°€ì‹œì¼œì•¼í•˜ëŠ”ë° í•œë²ˆë§Œ ì¦ê°€ë  ìˆ˜ë„ ìˆìŒ.

### ì»¤ë°‹ í›„ ì½ê¸° êµ¬í˜„

2ë‹¨ê³„ë¡œ ë§¤ìš° ë„ë¦¬ ì“°ì´ëŠ” ê²©ë¦¬ ìˆ˜ì¤€, ì˜¤ë¼í´, pg ë“±ì˜ ê¸°ë³¸ ì„¤ì •

ë¡œìš° ìˆ˜ì¤€ ê°€ë²¼ìš´ ì ê¸ˆì„ ì‚¬ìš©í•´ ë”í‹° ì“°ê¸°ë¥¼ ë°©ì§€í•˜ê³ , íŠ¸ëœì­ì…˜ì´ ê°ì²´ë¥¼ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´ ê°ì²´ì— ëŒ€í•œ ì ê¸ˆì„ íšë“í•´ì•¼ í•¨. 

ë”í‹° ì½ê¸°ëŠ” ì–´ë–»ê²Œ ë§‰ì„ ìˆ˜ ìˆì„ê¹Œ? ì ê¸ˆì„ ì“°ë©´ ë„ˆë¬´ ëŠë ¤ì§.

ê³¼ê±° ê°’ì„ ìœ ì§€í•´ì„œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ê³¼ê±° ê°’ì„ ì½ê²Œ ë§Œë“¤ë©´ ëŒ -> ìŠ¤ëƒ…ìˆ

#### ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì™€ ë°˜ë³µ ì½ê¸°

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ëŠ”, íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ì˜ ìŠ¤ëƒ…ìˆì„ ë§Œë“¤ì–´ ë†“ê³  **ìŠ¤ëƒ…ìˆ(ì •í•©ëœ ë³µì‚¬ë³¸)**ì„ ì½ê²Œ í•˜ëŠ”ê²ƒ.

non repeateable read ë¬¸ì œëŠ”, í•œ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°™ì€ ë°ì´í„°ë¥¼ ì½ëŠ”ë° ì™¸ë¶€ íŠ¸ëœì­ì…˜ì—ì„œ ì½ëŠ” ë„ì¤‘ ìˆ˜ì •í•´ì„œ ë‘ë²ˆì§¸ ì½ì—ˆì„ ë•Œ ì½ì€ ê°’ì´ ë°”ë€ ë¬¸ì œ.

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ëŠ” ì´ëŸ° ë¬¸ì œì˜ ê°€ì¥ í”í•œ í•´ê²°ì±…ìœ¼ë¡œ  DBMSë§ˆë‹¤ ë‹¤ë¥´ì§€ë§Œ MVCC ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•¨. ê·¸ëŸ¬ë‚˜ íŒ¬í…€ ë¦¬ë“œ ìì²´ëŠ” ë°©ì§€í•˜ì§€ ëª»í•¨

* íŒ¬í…€ë¦¬ë“œ : íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ê°™ì€ ì¡°ê±´ì˜ ì¿¼ë¦¬ë¥¼ ë‘ ë²ˆ ì‹¤í–‰í–ˆëŠ”ë°, ë‘ ë²ˆì§¸ì— ìƒˆë¡œìš´ í–‰(=íŒ¬í…€)ì´ íŠ€ì–´ë‚˜ì˜¤ëŠ” í˜„ìƒ

* ìŠ¤ëƒ…ìˆì˜ í•µì‹¬ì€ ì½ëŠ” ìª½ì—ì„œ ì“°ëŠ” ìª½ì„ ì°¨ë‹¨í•˜ì§€ ì•Šê³  ì“°ëŠ” ìª½ì—ì„œ ì½ëŠ” ìª½ì„ ì°¨ë‹¨í•˜ì§€ ì•ŠëŠ”ê²ƒ.,

postgresqlì€ íŠ¸ëœì­ì…˜ ë§ˆë‹¤ idë¥¼ ë¶€ì—¬í•´ íŠ¸ëœì­ì…˜ì— ì˜í•´ ìƒì„±ë˜ê±°ë‚˜ ìˆ˜ì •ëœ rowì˜ í˜ì´ì§€ì— txid ê°’ì„ ë¶™ì´ê³ , ë‹¤ìŒ íŠ¸ëœì­ì…˜ idê°’ìœ¼ë¡œ ë¹„êµí•˜ë©´ì„œ ì´ê²ƒì„ êµ¬í˜„í•¨.

#### ì¼ê´€ëœ ìŠ¤ëƒ…ìˆì„ ë³´ëŠ” ê°€ì‹œì„± ê·œì¹™

txidë¥¼ ì´ìš©í•´ ì–´ë–¤ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ ê²°ì •í•œë‹¤.

1. ï»¿ï»¿ï»¿ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê° íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•  ë•Œ ê·¸ ì‹œì ì— ì§„í–‰ ì¤‘ì¸(ì•„ì§ ì»¤ë°‹ì´ë‚˜ ì–´ë³´íŠ¸ê°€ ë˜ì§€ ì•Šì€) ëª¨ë“  íŠ¸ëœì­ì…˜ì˜ ëª©ë¡ì„ ë§Œë“ ë‹¤. ì´ íŠ¸ëœì­ì…˜ë“¤ì´ ì“´ ë°ì´í„°ëŠ” ëª¨ë‘ ë¬´ì‹œëœë‹¤. ì„¤ë ¹ ë°ì´í„°ë¥¼ ì“´ íŠ¸ëœì­ì…˜ì´ ë‚˜ì¤‘ì— ì»¤ë°‹ë˜ë”ë¼ë„ ë§ˆì°¬ê°€ì§€ë‹¤.
2. ï»¿ï»¿ï»¿ì–´ë³´íŠ¸ëœ íŠ¸ëœì­ì…˜ì´ ì“´ ë°ì´í„°ëŠ” ëª¨ë‘ ë¬´ì‹œëœë‹¤.
3. ï»¿ï»¿ï»¿íŠ¸ëœì­ì…˜ IDê°€ ë” í°(ì¦‰ í˜„ì¬ íŠ¸ëœì­ì…˜ì´ ì‹œì‘í•œ í›„ì— ì‹œì‘í•œ) íŠ¸ëœì­ì…˜ì´ ì“´ ë°ì´í„°ëŠ” ê·¸ íŠ¸ëœì­ì…˜ì˜ ì»¤ë°‹ ì—¬ë¶€ì— ê´€ê³„ ì—† ì´ ëª¨ë‘ ë¬´ì‹œëœë‹¤.
4. ï»¿ï»¿ï»¿ê·¸ ë°–ì˜ ëª¨ë“  ë°ì´í„°ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì§ˆì˜ë¡œ ë³¼ ìˆ˜ ìˆë‹¤.

#### ë°˜ë³µ ì½ê¸°

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ëŠ” ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ì— ìœ ìš©í•˜ë‹¤. ì´ë¦„ì´ í—·ê°ˆë¦¬ê¸´ í•˜ëŠ”ë° ì˜¤ë¼í´ì—ì„œëŠ” ì§ë ¬ì„±,

pgì™€ mysqlì—ì„œëŠ” repeatable readë¼ê³  í•œë‹¤

* ì´ëŸ° ì´ìœ ëŠ” SQL í‘œì¤€ì—ëŠ” ìŠ¤ëƒ…ìˆ ê²©ë¦¬ë¼ëŠ” ê°œë…ì´ ì—†ìŒ

### ê°±ì‹  ì†ì‹¤ ë°©ì§€

ì§€ê¸ˆê¹Œì§€ëŠ” ë”í‹° ë¦¬ë“œë¥¼ ë°©ì§€í•˜ëŠ” ë°©ë²•ì´ê³  ê°±ì‹  ì†ì‹¤ì€ ë‹¤ë¥¸ ë¬¸ì œë‹¤.

ê°±ì‹ ì†ì‹¤ì€ ë‘ ê°œ ì´ìƒì˜ íŠ¸ëœì­ì…˜ì´ ê°™ì€ ë°ì´í„°ë¥¼ ì½ê³  ìˆ˜ì •í•œ ë’¤, ë§ˆì§€ë§‰ì— ì»¤ë°‹ëœ íŠ¸ëœì­ì…˜ì´ ì´ì „ íŠ¸ëœì­ì…˜ì˜ ìˆ˜ì •ì„ ë®ì–´ì¨ì„œ ì†ì‹¤ì´ ë°œìƒí•˜ëŠ” ê²ƒ

ì£¼ë¡œ ì•„ë˜ ì™€ ê°™ì€ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ë°œìƒ

* ì¹´ìš´í„° ì¦ê°€ ë° ê³„ì¢Œ ì”ê³  ê°±ì‹ ì‹œ
* JSON ë¬¸ì„œ ë‚´ì— ë¦¬ìŠ¤íŠ¸ì— ì—˜ë ˆë¨¼íŠ¸ ì¶”ê°€ì‹œ

í•´ê²°ë°©ë²•

#### ì›ìì  ì“°ê¸° ì—°ì‚°

read-modify-write ëŒ€ì‹ í•˜ëŠ” ë°©ë²•ë“¤ì„ ì œê³µí•¨

rdbê°™ì€ê²½ìš°ëŠ” ì´ë ‡ê²Œí•˜ë©´ ì•ˆì „í•˜ë‹¤ê³  í•œë‹¤

```
UPDATE counters SET value = value + 1 WHERE key = 'foo'
```

* DBê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì´ ë¬¸ì¥ì„ **ì›ìì (atomic)** ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ë•Œë¬¸
* í•´ë‹¹ í–‰ì— ë‚´ë¶€ì ìœ¼ë¡œ exclusive lockë½ì„ ê±¸ìŒ -> `UPDATE` ëª…ë ¹ì–´ëŠ” ìë™ìœ¼ë¡œ `FOR UPDATE` ë½ì„ ë‚´ì¬ì ìœ¼ë¡œ ì‚¬ìš©

ëª½ê³  DBë„ ì¼ë¶€ë¥¼ ë³€ê²½í•˜ëŠ” ì›ì ì—°ì‚°ì„ ì œê³µí•˜ê³ , ë ˆë””ìŠ¤ëŠ”  prioritiy queueê°™ì€ êµ¬ì¡°ì—ì„œ right out left inì€ ì›ìì  ì—°ì‚°ì„ ì œê³µí•¨ 

#### ëª…ì‹œì  ì ê¸ˆ

ì´ê±´ LOCKì„

 Row-level Lock ì¢…ë¥˜

| ë½ ì´ë¦„             | ì„¤ëª…                                                         |
| ------------------- | ------------------------------------------------------------ |
| `FOR UPDATE`        | update/delete ì¶©ëŒ ë°©ì§€ìš©, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ë™ì¼ í–‰ ì ‘ê·¼ ëŒ€ê¸° |
| `FOR NO KEY UPDATE` | foreign key ë“± key ë³€ê²½ ì—†ì„ ë•Œ ì‚¬ìš©                         |
| `FOR SHARE`         | ì½ê¸° ìš©ë„                                                    |
| `FOR KEY SHARE`     | ì™¸ë˜ í‚¤ ì½ê¸°ìš©                                               |

ë°ë“œë½, ì„±ëŠ¥ì €í•˜ ìœ ë°œ ê°€ëŠ¥

#### ê°±ì‹  ì†ì‹¤ ìë™ ê°ì§€ - compare-and-set

ì´ ì—°ì‚°ì˜ ëª©ì ì€ ê°’ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ ì½ì€ í›„ë¡œ ë³€ê²½ë˜ì§€ ì•Šì•˜ì„ë•Œë§Œ ê°±ì‹ ì„ í—ˆìš©í•˜ëŠ”ê²ƒì„ (ì–´ë–»ê²Œ ë³´ë©´ ë‚™ê´€ì  ë½)

```
UPDATE pages SET content = 'new content'
WHERE id = 1234 AND content = 'old content';
```



### ì“°ê¸° ìŠ¤íì™€ íŒ¬ë¤

ë™ì‹œ ì‹¤í–‰ëœ ë‘ íŠ¸ëœì­ì…˜ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ê³  ê°ê° ë‹¤ë¥¸ ê°ì²´ë¥¼ ê°±ì‹ í•˜ì§€ë§Œ, ê·¸ ê²°ê³¼ë¡œ ì „ì²´ ì‹œìŠ¤í…œ ì œì•½ì„ ìœ„ë°˜í•˜ê²Œ ë˜ëŠ” í˜„ìƒ.

* ë”í‹°ì“°ê¸°ë„ ê°±ì‹  ì†ì‹¤ë„ ì•„ë‹˜.

ë‹¤ë¥¸ í•œëª…ì´ ì¡´ì¬í•´ì„œ ìµœì†Œ í•œëª…ì´ë¼ëŠ” ì¡°ê±´ì„ ìœ„ë°˜í•¨.

* **ë™ì‹œì— ì‹¤í–‰ëœ íŠ¸ëœì­ì…˜ë“¤ì´ ê°ê° â€œì¡°ê±´ì„ ë§Œì¡±í•œë‹¤ê³  ì°©ê°â€í•˜ê³  ë°ì´í„°ë¥¼ ìˆ˜ì •í•´ì„œ**,
  **ê²°ê³¼ì ìœ¼ë¡œ ì‹œìŠ¤í…œ ê·œì¹™ì´ë‚˜ ë¶ˆë³€ ì¡°ê±´(invariant)ì„ ê¹¨ëœ¨ë¦¬ëŠ” í˜„ìƒ**

**ëŒ€í‘œ ì˜ˆì‹œ: ì˜ì‚¬ í˜¸ì¶œ ëŒ€ê¸° ì‹œìŠ¤í…œ**

- ë³‘ì›ì€ í•­ìƒ **ìµœì†Œ í•œ ëª…**ì˜ ì˜ì‚¬ê°€ ëŒ€ê¸° ì¤‘ì´ì–´ì•¼ í•¨
- ì•¨ë¦¬ìŠ¤ì™€ ë°¥ ëª¨ë‘ ë™ì‹œì— â€œë‹¤ë¥¸ ì‚¬ëŒì´ ìˆìœ¼ë‹ˆ ë‚˜ëŠ” ë‚˜ê°€ë„ ë˜ê² ì§€â€ë¼ê³  íŒë‹¨í•˜ê³  ê°ê° ìì‹ ì˜ ëŒ€ê¸° ìƒíƒœë¥¼ ë”
- ë‘ íŠ¸ëœì­ì…˜ ëª¨ë‘ ì»¤ë°‹ â†’ **ê²°ê³¼ì ìœ¼ë¡œ ì•„ë¬´ë„ ëŒ€ê¸°í•˜ì§€ ì•Šê²Œ ë¨**
- ğŸ’¥ ì‹œìŠ¤í…œ ì œì•½ ìœ„ë°˜ (ë™ì‹œì„± ë¬¸ì œì§€ë§Œ row ì¶©ëŒì€ ì—†ìŒ)

**íŠ¹ì§•**

- **ë™ì¼í•œ ê°ì²´ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ë°œìƒ**
- **ìŠ¤ëƒ…ìˆ ê²©ë¦¬ ìˆ˜ì¤€ì—ì„œëŠ” ê°ì§€ë˜ì§€ ì•ŠìŒ**

ë‹¤ë¥¸ ì˜ˆ

* íšŒì˜ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ : ì¤‘ë³µ ì˜ˆì•½í•  ìˆ˜ ì—†ê²Œ í•˜ê³  ì‹¶ì„ ë•Œ ì¶©ëŒí•˜ëŠ” ì˜ˆì•½ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì—†ë‹¤ë©´ ì˜ˆì•½ 
  * ìŠ¤ëƒ…ìˆ ê²©ë¦¬ë¡œ ë§‰ì„ ìˆ˜ ì—†ìŒ
* ë‹¤ì¤‘ í”Œë ˆì´ì–´ ê²Œì„ : ê°±ì‹  ì†ì‹¤ ë°©ì§€ìœ„ì— ì ê¸ˆì„ ì‚¬ìš©í•´ë„, ë‘ í”Œë ˆì´ì–´ê°€ ë‹¤ë¥¸ ì•„ì´í…œì„ ì›€ì§ì´ëŠ”ê²ƒ ìì²´ë¥¼ ë§‰ì•„ì£¼ì§„ ì•ŠìŒ
* ì‚¬ìš©ìëª… íšë“ : ìœ ì¼í•œ ì‚¬ìš©ìëª…ì„ ê°€ì ¸ì•¼ í•  ë•Œ, ë™ì‹œì— ê°™ì€ ì‚¬ìš©ìëª…ìœ¼ë¡œ ê³„ì • ìƒì„± ì‹œë„ ë¶ˆê°€ëŠ¥ -> ì´ì¼€ì´ìŠ¤ëŠ” ìœ ì¼ ì œì•½ ì¡°ê±´ì´ í•´ê²°ì±…

#### ì“°ê¸° ìŠ¤íë¥¼ ìœ ë°œí•˜ëŠ” íŒ¬í…€ 

ì´ ëª¨ë“  ì˜ˆëŠ” ë¹„ìŠ·í•œ íŒ¨í„´ì„ ë”°ë¦„

1. SELECTê°€ ì¡°ê±´ì— ë§ëŠ” ë¡œìš°ë¥¼ ê²€ìƒ‰í•¨ìœ¼ë¡œì¨ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸í•¨. 

2. ì§ˆì˜ì˜ ê²°ê³¼ì— ë”°ë¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œëŠ” ì–´ë–»ê²Œ ì§„í–‰í• ì§€ ê²°ì •í•¨
3. ì²˜ë¦¬í•˜ê¸°ë¡œ í–ˆë‹¤ë©´ DBì— ì“°ê³  íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•¨. ê·¸ëŸ¬ë‚˜ ì§ˆì˜ë¥¼ ì¬ì‹¤í–‰í•˜ë©´ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ì–»ê²ŒëŒ

ì¦‰. ì–´ë–¤ íŠ¸ëœì­ì…˜ì—ì„œ ì‹¤í–‰í•œ ì“°ê¸°ê°€, ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì˜ ì§ˆì˜ ê²°ê³¼ë¥¼ ë°”ê¾¸ëŠ” íš¨ê³¼ë¥¼ íŒ¬í…€ ë¦¬ë“œë¼ê³  í•œë‹¤.

## ì§ë ¬ì„±

ê²½ìŸ ì¡°ê±´ ê°ì§€ì— ë„ì›€ì´ ë˜ëŠ” ì¢‹ì€ ë„êµ¬ë„ ì—†ê³ , í…ŒìŠ¤íŠ¸í•˜ê¸°ë„ ì–´ë µë‹¤.

ì´ê²½ìš° ì§ë ¬ì„±ì„ ì´ìš©í•˜ë©´ ëœë‹¤

ì‹±ê¸€ìŠ¤ë ˆë“œë¡œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë ˆë””ìŠ¤ ê°™ì€ ë°©ì‹ë„ ìˆë‹¤.

ê·¸ëŸ¬ë‚˜ DBì—ì„œ í•œë²ˆì— í•˜ë‚˜ íŠ¸ëœì­ì…˜ë§Œ ì²˜ë¦¬í•˜ë©´ ì²˜ë¦¬ëŸ‰ì€ ë§¤ìš° ë‚®ì•„ì§„ë‹¤.

## 2ë‹¨ê³„ ì ê¸ˆ

2PL ë§ê³  2ë‹¨ê³„ ì ê¸ˆ.

íŠ¸ëœì­ì…˜ì—ì„œ **ì ê¸ˆ(lock)** ì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ ì¤‘ í•˜ë‚˜ë¡œ,
 **ëª¨ë“  ì ê¸ˆì„ ë¨¼ì € íšë“í•˜ê³ ** â†’ **ëª¨ë‘ í•´ì œí•˜ëŠ” ê·œì¹™**ì„ ë”°ë¥´ëŠ” ë™ì‹œì„± ì œì–´ ê¸°ë²•

- ï»¿ï»¿íŠ¸ëœì­ì…˜ Aê°€ ê°ì²´ í•˜ë‚˜ë¥¼ ì½ê³  íŠ¸ëœì­ì…˜ Bê°€ ê·¸ ê°ì²´ì— ì“°ê¸°ë¥¼ ì›í•œë‹¤ë©´ BëŠ” ì§„í–‰í•˜ê¸° ì „ì— Aê°€ ì»¤ë°‹ë˜ê±°ë‚˜ ì–´ë³´íŠ¸ë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤(ì´ë ‡ê²Œ í•˜ë©´ Bê°€ A ëª°ë˜ ê°‘ìê¸° ê°ì²´ë¥¼ ë³€ê²½í•˜ì§€ ëª»í•˜ë„ë¡ ë³´ì¥ëœë‹¤).
- ï»¿ï»¿íŠ¸ëœì­ì…˜ Aê°€ ê°ì²´ì— ì¼ê³  íŠ¸ëœì­ì…˜ Bê°€ ê·¸ ê°ì²´ë¥¼ ì½ê¸° ì›í•œë‹¤ë©´ BëŠ” ì§„í–‰í•˜ê¸° ì „ì— Aê°€ ì»¤ë°‹ë˜ê±°ë‚˜ ì–´ë³´íŠ¸ë  ë•Œê¹Œì§€ ê¸° ë‹¤ë ¤ì•¼ í•œë‹¤(ê·¸ë¦¼ 7-4ì— ë‚˜ì™”ë“¯ì´ 2PLì„ ì“¸ ë•ŒëŠ” ê°ì²´ì˜ ê³¼ê±° ë²„ì „ì„ ì½ëŠ” ê²Œ í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤).

êµ¬í˜„ ë°©ë²•

ê° ê°ì²´ì— ì ê¸ˆì„ ì‚¬ìš©í•´ êµ¬í˜„í•¨. ì ê¸ˆìŒ shardë‘ exclusiveë¡œ í•  ìˆ˜ ìˆìŒ. -> ë¹„ê´€ì  ë™ì‹œì„± ì œì–´ 

ë‹¨ì ìœ¼ë¡œ êµì°© ìƒíƒœ ë°œìƒ ê°€ëŠ¥í•˜ê²Œë„ í•¨.

### 2ë‹¨ê³„ ì ê¸ˆì˜ ì„±ëŠ¥

ë™ì‹œì„±ì´ ì¤„ì–´ë“¤ì–´ ì²˜ë¦¬ëŸ‰ê³¼ ì§ˆì˜ ì‘ë‹µ ì‹œê°„ì´ ë§¤ìš° ëŠë ¤ì§. ë˜í•œ ë°ë“œë½ë„ ë§¤ìš° ë°œìƒ í™•ë¥ ì´ ë†’ì•„ì§

### ì„œìˆ  ì ê¸ˆ

predicate lock : **íŠ¹ì • ì¡°ê±´(Predicate)ì„ ë§Œì¡±í•˜ëŠ” ëª¨ë“  ë ˆì½”ë“œì— ëŒ€í•œ ì ê¸ˆ**
 â†’ ì‹¬ì§€ì–´ **ì•„ì§ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ê¹Œì§€ í¬í•¨í•´ì„œ** ë½ì„ ê±°ëŠ” ë°©ì‹

```sql
select * from bookings
where room_id = 123 and
end_time > 2024~
and start_time < 2025~
```

ì´ì¼€ì´ìŠ¤ëŠ” ë¯¸ë˜ì— ì¶”ê°€ë  íŒ¬í…€ì—ë„ ì ìš©í•  ìˆ˜ ìˆê²Œ ëŒ. 

### ì§ë ¬ì„± ìŠ¤ëƒ…ìˆ ê²©ë¦¬ SSI

ì´ ì•Œê³ ë¦¬ì¦˜ì€ ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì— ë¹„í•´ ì•½ê°„ì˜ ì„±ëŠ¥ ì†í•´ë§Œ ìˆì„ ë¶„ ì¢‹ì€ ì•Œê³ ë¦¬ì¦˜

#### ë¹„ê´€ì  ë™ì‹œì„± ì œì–´ vs ë‚™ê´€ì  ë™ì‹œì„± ì œì–´

2ë‹¨ê³„ ì ê¸ˆì€ ë¹„ê´€ì  ë™ì‹œì„± ì œì–´ ë©”ì»¤ë‹ˆì¦˜ì„ .

SSIëŠ” ë‚™ê´€ì  ë™ì‹œì„± ì œì–´ ê¸°ë²•ì„

ì¶©ëŒì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤ê³  ë³´ê±°ë‚˜, ì¶©ëŒì´ ë°œìƒí•˜ë©´ ì–´ë³´íŠ¸í•˜ê³  ì¬ì‹œë„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ”ê²ƒ.

ê³„ì† ì¬ì‹œë„ë˜ë©´ ë¶€í•˜ë¥¼ ì–´ëŠì •ë„ ìœ ë°œí•˜ê² ì§€ë§Œ, ê·¸ë˜ë„ ë¹„ê´€ì  ë™ì‹œì„± ì œì–´ë³´ë‹¤ëŠ” ì„±ëŠ¥ì´ ì¢‹ì€ ê²½í–¥ì´ ìˆë‹¤.

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ëœ ìŠ¤ëƒ…ìˆì„ ë³´ê³  ì¶©ëŒì„ ê°ì§€í•œë‹¤

* ë‚™ê´€ì  ë½ì´ë‘ì€ ë‹¤ë¥¸ê±° ê°™ìŒ. DBì˜ Serializable isolation level ê°™ìŒ. 

**ì˜¤ë˜ëœ ì½ê¸°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì˜ëª»ëœ íŒë‹¨ì„ í•˜ë©´ ì•ˆ ë¨** â†’ ê°ì§€ í•„ìš”

```
1. íŠ¸ëœì­ì…˜ì´ ìŠ¤ëƒ…ìˆì—ì„œ ì½ê¸° ìˆ˜í–‰ â†’ ì½ì€ ë²”ìœ„ ê¸°ë¡ (SIREAD lock)
2. ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ í•´ë‹¹ ë²”ìœ„ì— ì“°ê¸° ì‹œë„ â†’ ì¶©ëŒ ì •ë³´ ê¸°ë¡
3. ì»¤ë°‹ ì‹œ:
   - ì¶©ëŒ ê°ì§€ â†’ ì¶©ëŒì´ ì§ë ¬í™”ë¥¼ ìœ„ë°°í•˜ë©´ ì–´ë³´íŠ¸
   - ì¶©ëŒ ì—†ê±°ë‚˜ ë¬´í•´í•˜ë©´ ì»¤ë°‹ í—ˆìš©
```

PostgreSQLì€ ì´ë¥¼ ìœ„í•´ **SIREAD (Serializable Read) ë½** ì„ ì‚¬ìš©

**ì •ë¦¬: Serializable Snapshot Isolation(SSI) í•µì‹¬ ë©”ì»¤ë‹ˆì¦˜**

| í•­ëª©               | ì„¤ëª…                                                       |
| ------------------ | ---------------------------------------------------------- |
| **ì½ê¸° ì‹œì **      | MVCC ê¸°ë°˜ ìŠ¤ëƒ…ìˆì—ì„œ ì½ìŒ (ì“°ê¸° ë¬´ì‹œ)                      |
| **ì¶©ëŒ ê°ì§€ ì‹œì ** | ì»¤ë°‹ ì‹œì ì— ê³¼ê±° ì½ê¸°ê°€ ìµœì‹  ë°ì´í„°ì— ì˜í–¥ì„ ë°›ì•˜ëŠ”ì§€ í™•ì¸ |
| **íŠ¸ëœì­ì…˜ ì¶”ì **  | ìƒ‰ì¸ ë²”ìœ„ ê¸°ë°˜ ì¶”ì , ì½ê¸°/ì“°ê¸° ê¸°ë¡ ì¼ì‹œì ìœ¼ë¡œ ìœ ì§€        |
| **ì§€ë¢°ì„  ë°©ì‹**    | ë½ ëŒ€ì‹  ê°ì‹œ â†’ ì°¨ë‹¨ ì—†ì´ ë™ì‘, ì»¤ë°‹ ì‹œ ì¶©ëŒ íŒë‹¨           |
| **ì¥ì **           | ì§€ì—° ì ìŒ, ì½ê¸° ì„±ëŠ¥ ë†’ìŒ, ë³‘ë ¬ ì²˜ë¦¬ì— ìœ ë¦¬                |
| **ë‹¨ì **           | ì¶”ì  ë¹„ìš© ìˆìŒ, ì»¤ë°‹ ì‹œ ì–´ë³´íŠ¸, ê¸´ íŠ¸ëœì­ì…˜ì— ì·¨ì•½         |

ë‚™ê´€ì  ë½(Optimistic Locking) vs SSI ì™„ì „ ë¹„êµ

| í•­ëª©           | ë‚™ê´€ì  ë½ (Optimistic Locking)                            | Serializable Snapshot Isolation (SSI)                  |
| -------------- | --------------------------------------------------------- | ------------------------------------------------------ |
| ì ìš© ìœ„ì¹˜      | **ì• í”Œë¦¬ì¼€ì´ì…˜/ORM ë ˆë²¨**ì—ì„œ ì§ì ‘ êµ¬í˜„ (e.g. `@Version`) | **DB ë‚´ë¶€ ì—”ì§„ ìˆ˜ì¤€**ì—ì„œ ìë™ìœ¼ë¡œ ì‘ë™                |
| ì¶©ëŒ ê°ì§€ ì‹œì  | **ì“°ê¸° ì§ì „ ë˜ëŠ” ì»¤ë°‹ ì§ì „** â†’ ë²„ì „ ë¹„êµë¡œ ê°ì§€           | **ì»¤ë°‹ ì‹œì **ì— ì½ê¸°-ì“°ê¸° ì¶©ëŒ ê´€ê³„ ê¸°ë°˜ìœ¼ë¡œ ê°ì§€      |
| ì¶©ëŒ ê°ì§€ ë°©ì‹ | `version` í•„ë“œ ê°™ì€ ë©”íƒ€ë°ì´í„° ë¹„êµ                       | **ì½ê¸°-ì“°ê¸° ì¶”ì  ê·¸ë˜í”„**, predicate lock, ì§€ë¢°ì„  ë°©ì‹ |
| ë²”ìœ„           | **ê°œë³„ row ë‹¨ìœ„** ì¶©ëŒ ë°©ì§€                               | **ë²”ìœ„ ê¸°ë°˜ predicate ì¶©ëŒ**ê¹Œì§€ ê°ì§€ (íŒ¬í…€ê¹Œì§€ í¬í•¨)  |
| ì¥ì            | êµ¬í˜„ ë‹¨ìˆœ, ì• í”Œë¦¬ì¼€ì´ì…˜ ë‹¨ì—ì„œ ì œì–´                       | MVCC ê¸°ë°˜ìœ¼ë¡œ ì§ë ¬ì„± ë³´ì¥, ë½ ì•ˆ ê±¸ê³  ì²˜ë¦¬ ê°€ëŠ¥        |
| ë‹¨ì            | ê°œë°œìê°€ ì§ì ‘ ì²˜ë¦¬ ë¡œì§ ì¶”ê°€ í•„ìš”                         | êµ¬í˜„ ë³µì¡, ì¶”ì  ë¹„ìš© ì¡´ì¬, ì–´ë³´íŠ¸ ë°œìƒ ê°€ëŠ¥            |
| ì‚¬ìš© ì˜ˆ        | JPA, Hibernate, Spring Dataì˜ `@Version`                  | PostgreSQL, FoundationDBì˜ `SERIALIZABLE` ê²©ë¦¬ ìˆ˜ì¤€    |

